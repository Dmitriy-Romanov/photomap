# üì¶ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ –±–∏–Ω–∞—Ä–Ω–∏–∫–∞ PhotoMap

## –¢–µ–∫—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

| –í–µ—Ä—Å–∏—è | –†–∞–∑–º–µ—Ä | –°–∂–∞—Ç–∏–µ |
|--------|--------|--------|
| –û—Ä–∏–≥–∏–Ω–∞–ª | 7.8 –ú–ë | ‚Äî |
| –° LTO + strip | 5.86 –ú–ë | 25% |
| –° opt-level="z" | 3.44 –ú–ë | **56%** ‚úì |

## –ü—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. Cargo.toml
```toml
[profile.release]
opt-level = "z"     # –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –Ω–∞ —Ä–∞–∑–º–µ—Ä –≤–º–µ—Å—Ç–æ —Å–∫–æ—Ä–æ—Å—Ç–∏
lto = "fat"         # –ë–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
codegen-units = 1   # –ï–¥–∏–Ω–∞—è –µ–¥–∏–Ω–∏—Ü–∞ –∫–æ–¥–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
strip = true        # –£–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–ª–∞–¥–æ—á–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
panic = "abort"     # –ú–µ–Ω—å—à–µ –∫–æ–¥–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–∞–Ω–∏–∫
```

### 2. .cargo/config.toml
```toml
[build]
rustflags = ["-C", "target-feature=+crt-static"]
```

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### UPX —É–ø–∞–∫–æ–≤–∫–∞ (—Ç—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏)
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å upx (–µ—Å–ª–∏ –µ—Å—Ç—å Chocolatey):
choco install upx

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å:
upx --best --lzma target/release/photomap_processor.exe
```

–≠—Ç–æ –º–æ–∂–µ—Ç —É–º–µ–Ω—å—à–∏—Ç—å –Ω–∞ –µ—â—ë 30-40%, –ø–æ–ª—É—á–∏–≤ ~2 –ú–ë –∏–ª–∏ –º–µ–Ω–µ–µ.

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ñ–ª–∞–≥–∏ –¥–ª—è –µ—â–µ –±–æ–ª—å—à–µ–≥–æ —Å–∂–∞—Ç–∏—è
```toml
[profile.release]
opt-level = "z"
lto = "fat"
codegen-units = 1
strip = true
panic = "abort"
# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:
# split-debuginfo = "off"
# embed-bitcode = true
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞
```bash
# –ü–æ–∫–∞–∑–∞—Ç—å —Ä–∞–∑–º–µ—Ä –≤ –ú–ë
powershell -c "$f=Get-Item target/release/photomap_processor.exe; [math]::Round($f.Length/1MB, 2)"
```

## –ö–æ–º–ø—Ä–æ–º–∏—Å—Å —Å–∫–æ—Ä–æ—Å—Ç—å vs —Ä–∞–∑–º–µ—Ä

**–¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (opt-level="z"):**
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 3.44 –ú–ë
- ‚ö†Ô∏è –°–∫–æ—Ä–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–∞ 5-10% –º–µ–¥–ª–µ–Ω–Ω–µ–µ
- ‚úÖ –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω–æ

–ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `opt-level = "3"` –≤–º–µ—Å—Ç–æ `"z"`.
