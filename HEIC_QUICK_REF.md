# HEIC Problem - Quick Reference for AI Researchers

## üéØ –ü—Ä–æ–±–ª–µ–º–∞ –≤ –æ–¥–Ω–æ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏
–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –æ—Ç–∫—Ä—ã—Ç—å HEIC-—Ñ–∞–π–ª —á–µ—Ä–µ–∑ libheif-sys –Ω–∞ Windows –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞ `LoadLibraryA error: 193` –Ω–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–º —É—Ä–æ–≤–Ω–µ, –∏ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–æ—á–∏—Ç–∞—Ç—å GPS-–¥–∞–Ω–Ω—ã–µ, —Ö–æ—Ç—è Windows –∏—Ö –≤–∏–¥–∏—Ç.

## üî¥ –û—à–∏–±–∫–∞
```
LoadLibraryA error: 193
```

- **–ö–æ–¥**: 193 (ERROR_INVALID_LEVEL)
- **–ú–µ—Å—Ç–æ**: stderr –≤—ã–≤–æ–¥ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ —Ñ—É–Ω–∫—Ü–∏–π libheif-sys
- **–£—Ä–æ–≤–µ–Ω—å**: –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ DLL Windows
- **–ü–æ–ø—ã—Ç–∫–∏ –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞**: ‚ùå –Ω–µ –ª–æ–≤–∏—Ç—Å—è –ø—Ä–æ–≥—Ä–∞–º–º–æ–π, –≤—ã–≤–æ–¥–∏—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é

## üìÇ –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|-----------|
| `src/main.rs` | –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ (—Ñ—É–Ω–∫—Ü–∏–∏ `extract_metadata_from_heif()` –∏ `decode_heif_to_image()`) |
| `Cargo.toml` | –ö–æ–Ω—Ñ–∏–≥: `libheif-sys = { version = "5.0", features = ["v1_20"] }` |
| `.cargo/config.toml` | –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: `VCPKG_ROOT`, `LIBHEIF_STATIC=1` |
| `HEIC_INVESTIGATION.md` | –ü–æ–¥—Ä–æ–±–Ω—ã–π –∞–Ω–∞–ª–∏–∑ (–≥–∏–ø–æ—Ç–µ–∑—ã, –ø–æ–ø—ã—Ç–∫–∏ —Ä–µ—à–µ–Ω–∏—è) |
| `photos/IMG_0279.HEIC` | –¢–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª —Å GPS (36¬∞42'18.23..., 30¬∞34'25.69...) |
| `photos/IMG_0280.HEIC` | –¢–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª —Å GPS |

## üß™ –ö–∞–∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –ø—Ä–æ–±–ª–µ–º—É

```bash
# –°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Ä—Å–∏—é —Å HEIC
cargo build --release --features heif

# –ó–∞–ø—É—Å—Ç–∏—Ç—å
./target/release/photomap_processor.exe

# –£–≤–∏–¥–∏—Ç–µ –≤ stderr:
# LoadLibraryA error: 193
# LoadLibraryA error: 193
# ‚ö†Ô∏è  –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ HEIC —Ñ–∞–π–ª–∞ ./photos\IMG_0279.HEIC: GPS-–¥–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ HEIF —Ñ–∞–π–ª–µ
```

–ü—Ä–æ–≥—Ä–∞–º–º–∞ **–ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É** (–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç JPG), –Ω–æ HEIC-—Ñ–∞–π–ª—ã –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è.

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

```bash
# –í–µ—Ä—Å–∏—è –ë–ï–ó HEIC —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ
cargo build --release

./target/release/photomap_processor.exe
# ‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ 12 JPG-—Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π —Å GPS
# ‚ùå HEIC-—Ñ–∞–π–ª—ã –ø—Ä–æ–ø—É—â–µ–Ω—ã (–Ω–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏)
```

## üî¨ –ß—Ç–æ –±—ã–ª–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–æ

| –ü–æ–ø—ã—Ç–∫–∞ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|---------|-----------|
| –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ x64-windows-static triplet | ‚ùå –û—à–∏–±–∫–∞ –æ—Å—Ç–∞–µ—Ç—Å—è |
| –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ DLL (libde265.dll, jpeg62.dll, turbojpeg.dll) | ‚ùå –ù–µ –ø–æ–º–æ–≥–∞–µ—Ç |
| LIBHEIF_STATIC=1, LIBHEIF_NO_PKG_CONFIG=1 | ‚ùå –ù–µ –ø–æ–º–æ–≥–∞–µ—Ç |
| –†–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ libheif-sys | ‚úÖ –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å |
| –í—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ libheif | ‚úÖ –ù—É–∂–Ω–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å |

## üß† –ì–∏–ø–æ—Ç–µ–∑—ã (–∏–∑ HEIC_INVESTIGATION.md)

1. **–ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å libheif-sys v5.0 —Å Windows** - –º–æ–∂–µ—Ç –±—ã—Ç—å –±–∞–≥ –≤ —ç—Ç–æ–π –≤–µ—Ä—Å–∏–∏
2. **–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** - libde265 –º–æ–∂–µ—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–∂–µ –ø—Ä–∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–π –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
3. **–ö–æ–Ω—Ñ–ª–∏–∫—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä** - –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –∏–ª–∏ triplet –¥–ª—è Windows x64
4. **–ü—Ä–æ–±–ª–µ–º–∞ —Å —Ñ—É–Ω–∫—Ü–∏–µ–π heif_context_alloc()** - –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—à–∏–±–∫–∞ –≤ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
5. **–ù–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** - –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è VC++ runtime –∏–ª–∏ –¥—Ä—É–≥–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
6. **–í—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ –Ω–µ –ø–æ–ª–Ω–æ–µ** - —á–∞—Å—Ç—å –∫–æ–¥–∞ –º–æ–∂–µ—Ç –ø—ã—Ç–∞—Ç—å—Å—è –∑–∞–≥—Ä—É–∂–∞—Ç—å DLL –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏

## üéØ –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ libheif-sys
```rust
// –í Cargo.toml –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å:
libheif-sys = { version = "4.1", optional = true }  // –ï—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
// –∏–ª–∏
libheif-sys = { version = "5.0.0", optional = true }  // –¢–æ—á–Ω–∞—è –≤–µ—Ä—Å–∏—è
// –∏–ª–∏ —Å–æ –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ–º (–µ—Å–ª–∏ –µ—Å—Ç—å)
libheif-sys = { version = "5.0", features = ["vendored"] }
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –î—Ä—É–≥–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
```toml
# –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π wrapper
heif-rs = "0.1"

# –∏–ª–∏ image-heic –µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
image-heic = "0.1"

# –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ImageMagick —á–µ—Ä–µ–∑ –ø—Ä–æ—Ü–µ—Å—Å
# –∏–ª–∏ FFmpeg –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ HEIC ‚Üí JPG
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –°–±–æ—Ä–∫–∞ libheif –∏–∑ –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤
```bash
# –°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å libheif –ª–æ–∫–∞–ª—å–Ω–æ —Å —Ñ–ª–∞–≥–∞–º–∏
git clone https://github.com/strukturag/libheif
cd libheif
./configure --enable-static --disable-shared
make install
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é
```

### –í–∞—Ä–∏–∞–Ω—Ç 4: –í—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ C-–∫–æ–¥–∞
```rust
// –û–±–æ–π—Ç–∏—Å—å –±–µ–∑ libheif-sys, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π C-–∫–æ–¥ —á–µ—Ä–µ–∑ build.rs
```

### –í–∞—Ä–∏–∞–Ω—Ç 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ libheif CLI-—É—Ç–∏–ª–∏—Ç–∞ –Ω–∞ —ç—Ç–æ–π —Å–∏—Å—Ç–µ–º–µ
heif-enc test.heic test.jpg  # –ï—Å–ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∑–Ω–∞—á–∏—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –≤ –ø–æ—Ä—è–¥–∫–µ
```

### –í–∞—Ä–∏–∞–Ω—Ç 6: –û—Ç–ª–∞–¥–∫–∞ –Ω–∞ C —É—Ä–æ–≤–Ω–µ
```c
// –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç –Ω–∞ C –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ libheif –Ω–∞–ø—Ä—è–º—É—é
#include <libheif/heif.h>
int main() {
    heif_context* ctx = heif_context_alloc();
    // ...
    heif_context_free(ctx);
}
// gcc test.c -lheif
```

## üìä –°—Ç–∞—Ç—É—Å Windows API

```
–û—à–∏–±–∫–∞ 193 (ERROR_INVALID_LEVEL):
- –û–±—ã—á–Ω–æ: "The level parameter is not valid"
- –í –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ LoadLibraryA: DLL –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∏–ª–∏ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–∞
- –ú–æ–∂–µ—Ç –±—ã—Ç—å: –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ DLL, –∫–æ–Ω—Ñ–ª–∏–∫—Ç –≤–µ—Ä—Å–∏–π
```

## üß© –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ—É–Ω–∫—Ü–∏–∏ extract_metadata_from_heif()

```
1. heif_context_alloc()              ‚Üê –í—ã–¥–µ–ª—è–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç (–≤—ã–≥–ª—è–¥–∏—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ)
2. heif_context_read_from_file()     ‚Üê –ß–∏—Ç–∞–µ—Ç —Ñ–∞–π–ª (???)
3. heif_context_get_primary_image_handle()  ‚Üê –ü–æ–ª—É—á–∞–µ—Ç handle (???)
4. heif_image_handle_get_list_of_metadata_block_IDs()  ‚Üê –ò—â–µ—Ç EXIF (???)
5. heif_image_handle_get_metadata()  ‚Üê –ò–∑–≤–ª–µ–∫–∞–µ—Ç EXIF (???)
6. exif::Reader::new().read_raw()    ‚Üê –ü–∞—Ä—Å–∏—Ç (–±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã)
7. get_gps_coord()                   ‚Üê –ò–∑–≤–ª–µ–∫–∞–µ—Ç GPS (–±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –µ—Å–ª–∏ EXIF –ø–∞—Ä—Å–µ–Ω–∞)

‚ùì –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ, –≤ –∫–∞–∫–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ—à–∏–±–∫–∞ LoadLibraryA
```

## üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—è

–ì–ª–∞–≤–Ω—ã–π –≤–æ–ø—Ä–æ—Å: **–ü–æ—á–µ–º—É libheif-sys/libde265 –ø—ã—Ç–∞—é—Ç—Å—è –∑–∞–≥—Ä—É–∂–∞—Ç—å DLL –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–π –∫–æ–º–ø–∏–ª—è—Ü–∏–∏?**

–í–æ–∑–º–æ–∂–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ:
- libheif-sys v5.0 –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `dlopen`/`LoadLibraryA` –≤–Ω—É—Ç—Ä–∏ –¥–∞–∂–µ –ø—Ä–∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–π –ª–∏–Ω–∫–æ–≤–∫–µ
- –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è HEVC –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è)
- –ò–ª–∏ –ø–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–ª–∞–≥–∏–Ω—ã/–∫–æ–¥–µ–∫–∏

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- –ò—Å—Ö–æ–¥–Ω–∏–∫–∏ libheif: https://github.com/strukturag/libheif
- libheif-sys crates.io: https://crates.io/crates/libheif-sys
- libde265: https://github.com/strukturag/libde265
- –û—Ç—á–µ—Ç –æ –ø—Ä–æ–±–ª–µ–º–µ: /HEIC_INVESTIGATION.md (—ç—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç)

## üìû –ö–æ–≥–¥–∞ –≤—ã –±—É–¥–µ—Ç–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å —ç—Ç–æ

1. –ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ HEIC_INVESTIGATION.md (–≤ –ø—Ä–æ–µ–∫—Ç–µ)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≥–∏–ø–æ—Ç–µ–∑—ã –ø–æ –æ–¥–Ω–æ–π
3. –ö–∞–∂–¥—ã–π —Ä–∞–∑ —Å–æ–±–∏—Ä–∞–π—Ç–µ —Å `cargo clean` –ø–µ—Ä–µ–¥ —Ç–µ—Å—Ç–æ–º
4. –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ —Ñ–∞–π–ª–∞—Ö IMG_0279.HEIC –∏ IMG_0280.HEIC
5. –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ stderr –≤—ã–≤–æ–¥ –æ—Å–æ–±–µ–Ω–Ω–æ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ
6. –î–æ–±–∞–≤–ª—è–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –Ω–æ–≤—ã–π commit –Ω–∞ –≤–µ—Ç–∫–µ

## ‚ú® –£–¥–∞—á–∏!

–ü—Ä–æ–±–ª–µ–º–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ —Ä–µ—à–∞–µ–º–∞—è, –ø—Ä–æ—Å—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ–≥–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –∏ –≤–æ–∑–º–æ–∂–Ω–æ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å —Ä–∞–∑–Ω—ã–º–∏ –ø–æ–¥—Ö–æ–¥–∞–º–∏.

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 14 –Ω–æ—è–±—Ä—è 2025
