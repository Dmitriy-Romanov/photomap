<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PhotoMap</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
    <link rel="stylesheet" href="/style.css" />
</head>

<body>
    <!-- Full-screen Map -->
    <div id="map" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 1;"></div>

    <!-- Floating Info Window -->
    <div id="floating-info-window"
        style="position: fixed; top: 10px; left: 60px; width: 350px; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border: 1px solid rgba(0,0,0,0.08); border-radius: 12px; z-index: 1000; box-shadow: 0 8px 24px rgba(0,0,0,0.12); font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; overflow: hidden; transition: height 0.3s ease;">
        <!-- Title Bar (always visible) -->
        <div id="window-title-bar"
            style="display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; background: rgba(255,255,255,0.5); border-bottom: 1px solid rgba(0,0,0,0.05); cursor: default;">
            <span style="font-size: 14px; font-weight: 600; color: #1a1a1a; letter-spacing: -0.3px;">üó∫Ô∏è PhotoMap</span>
            <button id="toggle-window-btn"
                style="background: transparent; color: #666; border: none; padding: 4px; border-radius: 4px; cursor: pointer; font-size: 12px; transition: background 0.2s;">‚åÑ</button>
        </div>

        <!-- Content Area (expandable) -->
        <div id="window-content" style="height: auto; max-height: calc(100vh - 100px); overflow-y: auto;">
            <!-- HEIC_WARNING_PLACEHOLDER -->
            <!-- Control Panel -->
            <div id="control-panel" style="padding: 16px; box-sizing: border-box;">

                <!-- Folder Selection -->
                <div style="margin-bottom: 16px;">
                    <label for="folder-input"
                        style="display: block; margin-bottom: 6px; font-weight: 500; font-size: 13px; color: #444;">üìÅ
                        Folder Path</label>
                    <input type="text" id="folder-input"
                        style="width: 100%; padding: 10px 12px; border: 1px solid #e0e0e0; border-radius: 8px; box-sizing: border-box; font-size: 13px; transition: border-color 0.2s, box-shadow 0.2s; outline: none;"
                        placeholder="/path/to/photos">
                </div>

                <!-- Processing Controls -->
                <div style="margin-bottom: 16px; display: flex; gap: 8px;">
                    <button id="process-button" onclick="processFolder()"
                        style="background: #28a745; color: white; border: none; padding: 10px 16px; border-radius: 8px; cursor: pointer; flex: 1.5; font-weight: 600; font-size: 13px; box-shadow: 0 2px 4px rgba(40, 167, 69, 0.2); transition: transform 0.1s, box-shadow 0.2s;">
                        üöÄ Process
                    </button>
                    <button id="close-button" onclick="shutdownApp()"
                        style="background: #dc3545; color: white; border: none; padding: 10px 16px; border-radius: 8px; cursor: pointer; flex: 1; font-weight: 600; font-size: 13px; box-shadow: 0 2px 4px rgba(220, 53, 69, 0.2); transition: transform 0.1s, box-shadow 0.2s;">
                        ‚ùå Close
                    </button>
                </div>

                <!-- Year Range Controls -->
                <div
                    style="margin-bottom: 16px; background: #f8f9fa; padding: 12px; border-radius: 8px; border: 1px solid #eee;">
                    <div
                        style="display: flex; align-items: center; justify-content: space-between; gap: 8px; font-size: 13px;">
                        <div style="display: flex; flex-direction: column; gap: 4px;">
                            <label for="year-from" style="font-weight: 500; color: #555;">From <span
                                    id="year-from-label"
                                    style="font-weight: 400; color: #888; font-size: 11px;"></span></label>
                            <input type="number" id="year-from"
                                style="width: 80px; padding: 6px 8px; border: 1px solid #ddd; border-radius: 6px; font-size: 13px;"
                                min="1900" max="2100" step="1">
                        </div>
                        <div style="color: #ccc;">‚Äî</div>
                        <div style="display: flex; flex-direction: column; gap: 4px;">
                            <label for="year-to" style="font-weight: 500; color: #555;">To <span id="year-to-label"
                                    style="font-weight: 400; color: #888; font-size: 11px;"></span></label>
                            <input type="number" id="year-to"
                                style="width: 80px; padding: 6px 8px; border: 1px solid #ddd; border-radius: 6px; font-size: 13px;"
                                min="1900" max="2100" step="1">
                        </div>
                    </div>
                </div>

                <!-- Processing Status -->
                <div id="processing-status"
                    style="margin-bottom: 16px; padding: 12px; background: #e8f5e9; border-radius: 8px; border: 1px solid #c8e6c9; display: none;">
                    <div id="status-text"
                        style="font-weight: 600; color: #2e7d32; font-size: 13px; margin-bottom: 4px;">Processing...
                    </div>
                    <div id="progress-text" style="font-size: 12px; color: #4caf50;"></div>
                </div>

                <!-- Statistics Display -->
                <div id="statistics-panel"
                    style="padding: 0; border-top: 1px solid #eee; padding-top: 12px; margin-top: 4px;">
                    <h4
                        style="margin: 0 0 8px 0; color: #888; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600;">
                        Statistics</h4>
                    <div style="display: flex; justify-content: space-between; font-size: 13px;">
                        <div style="color: #444;">Total: <strong id="total-photos" style="color: #1a1a1a;">-</strong>
                        </div>
                        <div style="color: #444;">Visible: <strong id="visible-photos"
                                style="color: #1a1a1a;">-</strong></div>
                    </div>
                </div>
            </div> <!-- control-panel -->
        </div> <!-- window-content -->
    </div> <!-- floating-info-window -->

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
    <script src="/script.js"></script>
</body>

</html>