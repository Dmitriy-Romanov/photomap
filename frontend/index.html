<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PhotoMap</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
    <link rel="stylesheet" href="/style.css" />
</head>

<body>
    <!-- Full-screen Map -->
    <div id="map"></div>

    <!-- Experimental UI Panel -->
    <div id="experimental-panel" class="exp-panel">
        <div class="exp-row">
            <div class="exp-cell w-25 cell-left">
                <a href="https://github.com/Dmitriy-Romanov/photomap" target="_blank"
                    style="text-decoration: none; color: inherit; font-weight: bold; padding-left: 4px;">üó∫Ô∏è
                    PhotoMap</a>
            </div>
            <div class="exp-cell w-60">
                <span id="exp-coordinates" class="map-coordinates" style="margin: 0; color: inherit;">Lat: 0.00000, Lon:
                    0.00000</span>
            </div>
            <div class="exp-cell w-15" style="justify-content: center;">
                <div class="window-controls">
                    <button class="control-btn" onclick="toggleExpPanel()" title="Minimize">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </button>
                    <button class="control-btn close" onclick="shutdownApp()" title="Close App">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        <div class="exp-row row-small">
            <div class="exp-cell w-23">
                <label class="map-coords-toggle" style="margin-left: 0;">
                    <span class="toggle-label">Map coord:</span>
                    <input type="checkbox" id="exp-map-coords-toggle" checked>
                </label>
            </div>
            <div class="exp-cell w-23">
                <label class="map-coords-toggle" style="margin-left: 0;">
                    <span class="toggle-label">Routes:</span>
                    <input type="checkbox" id="exp-routes-toggle">
                </label>
            </div>
            <div class="exp-cell w-23">
                <label class="map-coords-toggle" style="margin-left: 0;">
                    <span class="toggle-label">Heatmap:</span>
                    <input type="checkbox" id="exp-heatmap-toggle">
                </label>
            </div>
            <div class="exp-cell w-31">
                <label class="map-coords-toggle" style="margin-left: 0;">
                    <span class="toggle-label">Browser autostart:</span>
                    <input type="checkbox" id="exp-browser-autostart-toggle">
                </label>
            </div>
        </div>
        <div class="exp-row">
            <div class="exp-cell w-60 cell-left">
                <span class="group-label" style="margin: 0; color: inherit;">Source folder</span>
            </div>
            <div class="exp-cell w-20">
                <button id="exp-open-button" class="icon-btn primary" onclick="openFolderDialog('exp')"
                    title="Open Folder">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z">
                        </path>
                    </svg>
                    Open
                </button>
            </div>
            <div class="exp-cell w-20">
                <button id="exp-process-button" class="icon-btn secondary" onclick="processFolder('exp')"
                    title="Process Current Path">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <polygon points="5 3 19 12 5 21 5 3"></polygon>
                    </svg>
                    Process
                </button>
            </div>
        </div>
        <div class="exp-row">
            <div class="exp-cell w-100">
                <div class="input-wrapper" style="width: 95%;">
                    <input type="text" id="exp-folder-input" class="folder-input full-width"
                        placeholder="Enter or select folder path..." value="">
                </div>
            </div>
        </div>
        <div class="exp-row row-small">
            <div class="exp-cell w-60">
                <span class="group-label" style="margin: 0; color: inherit;">Year range <span
                        id="exp-year-range-label"></span></span>
            </div>
            <div class="exp-cell w-20">
                <span class="stat-label" style="margin: 0; color: inherit;">Total photos</span>
            </div>
            <div class="exp-cell w-20">
                <span class="stat-label" style="margin: 0; color: inherit;">Visible on map</span>
            </div>
        </div>
        <div class="exp-row">
            <div class="exp-cell w-60" style="display: flex; align-items: center; justify-content: center; gap: 4px;">
                <span>From:</span>
                <input type="number" id="exp-year-from" name="pm-year-from" class="year-input" placeholder="From"
                    min="1900" max="2099" autocomplete="new-password" data-lpignore="true" onkeydown="return false">
                <span>-</span>
                <span>To:</span>
                <input type="number" id="exp-year-to" name="pm-year-to" class="year-input" placeholder="To" min="1900"
                    max="2099" autocomplete="new-password" data-lpignore="true" onkeydown="return false">
                <span id="exp-year-range-label" class="stat-label"
                    style="margin-left: 4px; font-weight: normal;"></span>
            </div>
            <div class="exp-cell w-20">
                <span id="exp-total-photos" class="stat-value" style="color: inherit;">0</span>
            </div>
            <div class="exp-cell w-20">
                <span id="exp-visible-photos" class="stat-value" style="color: inherit;">0</span>
            </div>
        </div>
    </div>

    <!-- Cluster Gallery Modal -->
    <div id="cluster-modal" class="cluster-modal hidden">
        <div class="cluster-modal-content">
            <div class="cluster-modal-header">
                <button id="cluster-back-btn" class="icon-btn hidden" onclick="showClusterGrid()" title="Back to Grid">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <line x1="19" y1="12" x2="5" y2="12"></line>
                        <polyline points="12 19 5 12 12 5"></polyline>
                    </svg>
                </button>
                <h3 id="cluster-title">Photos in this location</h3>
                <button class="icon-btn close-modal" onclick="closeClusterModal()" title="Close">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>



            <!-- Grid View -->
            <div id="cluster-grid-view" class="cluster-view">
                <div id="cluster-grid" class="cluster-grid">
                    <!-- Thumbnails will be injected here -->
                </div>

                <!-- Pagination Controls -->
                <div id="cluster-pagination" class="cluster-pagination hidden">
                    <button id="pagination-prev" class="pagination-btn" onclick="changeGalleryPage(-1)">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="15 18 9 12 15 6"></polyline>
                        </svg>
                        Prev
                    </button>
                    <span id="pagination-info" class="pagination-info">Page 1 of 1</span>
                    <button id="pagination-next" class="pagination-btn" onclick="changeGalleryPage(1)">
                        Next
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="9 18 15 12 9 6"></polyline>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Detail View -->
            <div id="cluster-detail-view" class="cluster-view hidden">
                <div class="detail-image-container">
                    <img id="cluster-detail-img" src="" alt="Photo">
                </div>
                <div class="detail-info">
                    <div id="cluster-detail-filename" class="detail-filename"></div>
                    <div id="cluster-detail-date" class="detail-date"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
    <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
    <script src="/script.js"></script>
</body>

</html>