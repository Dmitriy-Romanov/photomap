<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PhotoMap</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
    <link rel="stylesheet" href="/style.css" />
</head>

<body>
    <!-- Full-screen Map -->
    <div id="map"></div>

    <!-- Floating Info Window -->
    <div id="floating-info-window" class="info-panel">
        <!-- Title Bar -->
        <div class="panel-header">
            <div class="app-title">
                <span>üó∫Ô∏è</span> PhotoMap
            </div>
            <label class="map-coords-toggle">
                <span class="toggle-label">Map coord:</span>
                <input type="checkbox" id="coords-toggle" checked>
            </label>
            <div class="coords-wrapper">
                <span id="map-coordinates" class="map-coordinates">Lat: 0.00000, Lon: 0.00000</span>
            </div>
            <div class="window-controls">
                <button id="toggle-window-btn" class="control-btn" onclick="toggleInfoWindow()" title="Minimize">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                </button>
                <button class="control-btn close" onclick="shutdownApp()" title="Close App">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Content Area -->
        <div id="window-content" class="panel-content">
            <!-- Processing Status Overlay -->
            <div id="processing-status" class="processing-overlay">
                <div class="spinner"></div>
                <div style="text-align: center;">
                    <div id="status-text">Processing...</div>
                    <div id="progress-text">Initializing...</div>
                </div>
            </div>

            <!-- Folder Selection -->
            <div class="control-group">
                <div class="control-header">
                    <label class="group-label">Source Folder</label>
                    <div class="header-actions">
                        <button id="open-button" class="icon-btn primary" onclick="openFolderDialog()"
                            title="Open Folder">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z">
                                </path>
                            </svg>
                            Open
                        </button>
                        <button id="process-button" class="icon-btn secondary" onclick="processFolder()"
                            title="Process Current Path">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polygon points="5 3 19 12 5 21 5 3"></polygon>
                            </svg>
                            Process
                        </button>
                    </div>
                </div>
                <div class="input-wrapper">
                    <input type="text" id="folder-input" class="folder-input full-width"
                        placeholder="Enter or select folder path..." value="">
                </div>
            </div>

            <!-- Year Range with Statistics -->
            <div class="year-range-row">
                <div class="year-range-left">
                    <label class="group-label">
                        Year Range
                        <span id="year-range-info" class="year-range-info"></span>
                    </label>
                    <div class="year-inputs">
                        <div class="year-field">
                            <label>From</label>
                            <input type="number" id="year-from" min="1900" max="2100" placeholder="YYYY">
                        </div>
                        <span class="year-separator">‚Äî</span>
                        <div class="year-field">
                            <label>To</label>
                            <input type="number" id="year-to" min="1900" max="2100" placeholder="YYYY">
                        </div>
                    </div>
                </div>

                <!-- Statistics (inline) -->
                <div class="stats-bar">
                    <div class="stat-item">
                        <span class="stat-label">Total Photos</span>
                        <span id="total-photos" class="stat-value">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Visible on Map</span>
                        <span id="visible-photos" class="stat-value">-</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Cluster Gallery Modal -->
    <div id="cluster-modal" class="cluster-modal hidden">
        <div class="cluster-modal-content">
            <div class="cluster-modal-header">
                <button id="cluster-back-btn" class="icon-btn hidden" onclick="showClusterGrid()" title="Back to Grid">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <line x1="19" y1="12" x2="5" y2="12"></line>
                        <polyline points="12 19 5 12 12 5"></polyline>
                    </svg>
                </button>
                <h3 id="cluster-title">Photos in this location</h3>
                <button class="icon-btn close-modal" onclick="closeClusterModal()" title="Close">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>

            <!-- Grid View -->
            <div id="cluster-grid-view" class="cluster-view">
                <div id="cluster-grid" class="cluster-grid">
                    <!-- Thumbnails will be injected here -->
                </div>

                <!-- Pagination Controls -->
                <div id="cluster-pagination" class="cluster-pagination hidden">
                    <button id="pagination-prev" class="pagination-btn" onclick="changeGalleryPage(-1)">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="15 18 9 12 15 6"></polyline>
                        </svg>
                        Prev
                    </button>
                    <span id="pagination-info" class="pagination-info">Page 1 of 1</span>
                    <button id="pagination-next" class="pagination-btn" onclick="changeGalleryPage(1)">
                        Next
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="9 18 15 12 9 6"></polyline>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Detail View -->
            <div id="cluster-detail-view" class="cluster-view hidden">
                <div class="detail-image-container">
                    <img id="cluster-detail-img" src="" alt="Photo">
                </div>
                <div class="detail-info">
                    <div id="cluster-detail-filename" class="detail-filename"></div>
                    <div id="cluster-detail-date" class="detail-date"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
    <script src="/script.js"></script>
</body>

</html>