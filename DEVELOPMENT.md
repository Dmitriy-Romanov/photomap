# PhotoMap Processor - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

## üéØ –ß—Ç–æ —ç—Ç–æ?

PhotoMap Processor ‚Äî —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π:
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ GPS-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –∏–∑ EXIF-–¥–∞–Ω–Ω—ã—Ö
- –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–Ω–∏–∞—Ç—é—Ä (700x700 px —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –ø—Ä–æ–ø–æ—Ä—Ü–∏–π)
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π –∫–∞—Ä—Ç—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Leaflet + OpenStreetMap
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ EXIF-–æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π

## üìã –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

### ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ
- **JPG, PNG, WebP, TIFF, BMP, GIF** —Å GPS-–¥–∞–Ω–Ω—ã–º–∏
- EXIF-–æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ 16 —Ñ–∞–π–ª–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞

### ‚ö†Ô∏è –í –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- **HEIC/HEIF/AVIF** - –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ libheif-sys (—Å–º. HEIC_INVESTIGATION.md)

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```bash
# –ü–æ–ª–æ–∂–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –≤ —Ç–µ–∫—É—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –∏–ª–∏ –ø–æ–¥–ø–∞–ø–∫–∏
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É
.\photomap_processor.exe

# –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:
# - .thumbnails/ - –ø–∞–ø–∫–∞ —Å –º–∏–Ω–∏–∞—Ç—é—Ä–∞–º–∏
# - geodata.js - –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–∞—Ä—Ç—ã
# - map.html - –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞
```

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

#### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Rust 1.70+ (edition 2021)
- Windows —Å Visual Studio Build Tools (–¥–ª—è —Å–±–æ—Ä–∫–∏)
- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: vcpkg –¥–ª—è HEIC-–ø–æ–¥–¥–µ—Ä–∂–∫–∏

#### –°–±–æ—Ä–∫–∞ (JPG-–≤–µ—Ä—Å–∏—è)
```bash
cargo build --release
```
–†–µ–∑—É–ª—å—Ç–∞—Ç: `target/release/photomap_processor.exe` (3.46 –ú–ë)

#### –°–±–æ—Ä–∫–∞ (HEIC-–≤–µ—Ä—Å–∏—è)
```bash
# –¢—Ä–µ–±—É–µ—Ç vcpkg —Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º libheif
cargo build --release --features heif
```
–†–µ–∑—É–ª—å—Ç–∞—Ç: `target/release/photomap_processor.exe` (9.75 –ú–ë)

#### Setup –¥–ª—è HEIC-–ø–æ–¥–¥–µ—Ä–∂–∫–∏ (Windows)
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å vcpkg: https://github.com/Microsoft/vcpkg
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å libheif:
   ```bash
   .\vcpkg install libheif:x64-windows-static libde265:x64-windows-static libjpeg-turbo:x64-windows-static
   ```
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ `.cargo/config.toml`:
   ```toml
   [env]
   VCPKG_ROOT = "D:\\path\\to\\vcpkg"
   VCPKG_DEFAULT_TRIPLET = "x64-windows-static"
   ```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
photomap/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îî‚îÄ‚îÄ main.rs              # –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ (661 —Å—Ç—Ä–æ–∫–∞)
‚îú‚îÄ‚îÄ Cargo.toml               # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ .cargo/
‚îÇ   ‚îî‚îÄ‚îÄ config.toml          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è vcpkg
‚îú‚îÄ‚îÄ photos/                  # –í—Ö–æ–¥–Ω—ã–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
‚îú‚îÄ‚îÄ .thumbnails/             # –í—ã—Ö–æ–¥–Ω—ã–µ –º–∏–Ω–∏–∞—Ç—é—Ä—ã (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è)
‚îú‚îÄ‚îÄ geodata.js               # JSON —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è)
‚îú‚îÄ‚îÄ map.html                 # –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞ (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è)
‚îú‚îÄ‚îÄ README.md                # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ OPTIMIZATION.md          # –ò—Å—Ç–æ—Ä–∏—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–∞–∑–º–µ—Ä–∞
‚îú‚îÄ‚îÄ HEIC_INVESTIGATION.md    # –û—Ç—á–µ—Ç –æ –ø—Ä–æ–±–ª–µ–º–µ HEIC
‚îî‚îÄ‚îÄ target/release/
    ‚îî‚îÄ‚îÄ photomap_processor.exe

```

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### apply_exif_orientation(source_path, img)
–ü—Ä–∏–º–µ–Ω—è–µ—Ç EXIF-–æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—é –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é:
- –¢–µ–≥ 1: –Ω–æ—Ä–º–∞–ª—å–Ω–æ
- –¢–µ–≥ 2: –æ—Ç—Ä–∞–∑–∏—Ç—å –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ
- –¢–µ–≥ 3: –ø–æ–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ 180¬∞
- –¢–µ–≥ 4: –æ—Ç—Ä–∞–∑–∏—Ç—å –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ
- –¢–µ–≥ 5: –ø–æ–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ 270¬∞ –∏ –æ—Ç—Ä–∞–∑–∏—Ç—å
- –¢–µ–≥ 6: –ø–æ–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ 90¬∞ (–≤–ø—Ä–∞–≤–æ)
- –¢–µ–≥ 7: –ø–æ–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ 90¬∞ –∏ –æ—Ç—Ä–∞–∑–∏—Ç—å
- –¢–µ–≥ 8: –ø–æ–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ 270¬∞ (–≤–ª–µ–≤–æ)

### create_thumbnail(source_path, thumbnail_path)
- –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
- –ü—Ä–∏–º–µ–Ω—è–µ—Ç EXIF-–æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—é
- –°–æ–∑–¥–∞–µ—Ç –º–∏–Ω–∏–∞—Ç—é—Ä—É —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω–æ–π 700px
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏ (–Ω–µ –æ–±—Ä–µ–∑–∞–µ—Ç)

### process_file(path)
–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞:
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ñ–æ—Ä–º–∞—Ç
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç GPS –∏ –¥–∞—Ç—É –∏–∑ EXIF
- –°–æ–∑–¥–∞–µ—Ç –º–∏–Ω–∏–∞—Ç—é—Ä—É
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç ImageMetadata

### extract_metadata_from_heif(path) [cfg(feature = "heif")]
–ò–∑–≤–ª–µ–∫–∞–µ—Ç GPS –∏ –¥–∞—Ç—É –∏–∑ HEIC-—Ñ–∞–π–ª–æ–≤ (—Ç—Ä–µ–±—É–µ—Ç feature "heif"):
- –û—Ç–∫—Ä—ã–≤–∞–µ—Ç HEIC –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —á–µ—Ä–µ–∑ libheif
- –ò—â–µ—Ç EXIF –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- –ü–∞—Ä—Å–∏—Ç EXIF –¥–ª—è GPS –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –∏ –¥–∞—Ç—ã

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–û–±—Ä–∞–±–æ—Ç–∫–∞**: –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è (rayon), ~16 —Ñ–∞–π–ª–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- **–°–∫–æ—Ä–æ—Å—Ç—å**: ~0.1-0.2 —Å–µ–∫ –Ω–∞ JPG (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–∞–∑–º–µ—Ä–∞)
- **–ü–∞–º—è—Ç—å**: –ø–æ—Ç–æ–∫–æ–≤–∞—è –∑–∞–ø–∏—Å—å JSON (–Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ –≤ –ø–∞–º—è—Ç—å)
- **–†–∞–∑–º–µ—Ä exe**: 3.46 –ú–ë (–±–µ–∑ HEIC) / 9.75 –ú–ë (—Å HEIC)

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### HEIC/HEIF/AVIF
- –û—à–∏–±–∫–∞ `LoadLibraryA error: 193` –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ HEIC-—Ñ–∞–π–ª–æ–≤
- –ö–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ, –Ω–æ –≤—ã–≤–æ–¥–∏—Ç –æ—à–∏–±–∫–∏ –Ω–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–º —É—Ä–æ–≤–Ω–µ
- **–°—Ç–∞—Ç—É—Å**: —Ç—Ä–µ–±—É–µ—Ç—Å—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ (—Å–º. HEIC_INVESTIGATION.md)

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- `OPTIMIZATION.md` - –∏—Å—Ç–æ—Ä–∏—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –±–∏–Ω–∞—Ä–Ω–∏–∫–∞ (7.8 –ú–ë ‚Üí 3.44 –ú–ë)
- `HEIC_INVESTIGATION.md` - –ø–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á–µ—Ç –æ –ø—Ä–æ–±–ª–µ–º–µ —Å HEIC –∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è—Ö –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è
- `Cargo.toml` - –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 14 –Ω–æ—è–±—Ä—è 2025
