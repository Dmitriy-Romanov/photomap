# Exif Parser Test Tool üïµÔ∏è‚Äç‚ôÇÔ∏è

**–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ç–µ—Å—Ç–æ–≤–∞—è –≤–µ—Ä—Å–∏—è GPS –ø–∞—Ä—Å–µ—Ä–∞ –∏–∑ PhotoMap** –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ –æ—Ç–ª–∞–¥–∫–∏.

## –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–≠—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç **–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã GPS –ø–∞—Ä—Å–µ—Ä–∞** –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è PhotoMap. 

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:**
1. ‚úÖ **Coverage (–ü–æ–∫—Ä—ã—Ç–∏–µ)** - –Ω–∞—Ö–æ–¥–∏–º –ª–∏ GPS —Ç–∞–º –≥–¥–µ –æ–Ω –µ—Å—Ç—å?
2. ‚úÖ **Accuracy (–¢–æ—á–Ω–æ—Å—Ç—å)** - –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ —á–∏—Ç–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã?

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç **–∏–¥–µ–Ω—Ç–∏—á–Ω—ã–π –∫–æ–¥ –ø–∞—Ä—Å–µ—Ä–∞** –∏–∑ PhotoMap (—Ç–∞ –∂–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ `kamadak-exif`)
- –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å **exiftool** (–∑–æ–ª–æ—Ç–æ–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç, 99.99% —Ç–æ—á–Ω–æ—Å—Ç—å)
- –í—ã—è–≤–ª—è–µ—Ç —Ñ–∞–π–ª—ã –≥–¥–µ –Ω–∞—à –ø–∞—Ä—Å–µ—Ä –æ—à–∏–±–∞–µ—Ç—Å—è
- –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–≥–æ–≤ ‚Üí –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–µ–∫—Ç PhotoMap

> **–í–∞–∂–Ω–æ:** –≠—Ç–æ –ù–ï —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –∞ **—Ç–µ—Å—Ç–æ–≤—ã–π —Å—Ç–µ–Ω–¥** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞—Ä—Å–µ—Ä–∞.

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### ‚ö†Ô∏è –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û: exiftool

–£—Ç–∏–ª–∏—Ç–∞ **–Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ exiftool!**

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ Windows:**
1. –°–∫–∞—á–∞–π—Ç–µ —Å [exiftool.org](https://exiftool.org/)
2. –ü–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ `exiftool(-k).exe` ‚Üí `exiftool.exe`
3. –ü–æ–ª–æ–∂–∏—Ç–µ –≤ `C:\Windows\` –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ PATH
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ: –æ—Ç–∫—Ä–æ–π—Ç–µ CMD –∏ –≤–≤–µ–¥–∏—Ç–µ `exiftool -ver`

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ macOS:**
```bash
brew install exiftool
```

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ Linux:**
```bash
sudo apt install libimage-exiftool-perl  # Debian/Ubuntu
# –∏–ª–∏
sudo pacman -S perl-image-exiftool       # Arch
```

## –°–∫–∞—á–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π .exe (Windows)

**–ù–µ –Ω—É–∂–Ω–∞ –∫–æ–º–ø–∏–ª—è—Ü–∏—è!** –°–∫–∞—á–∞–π—Ç–µ —Å–æ–±—Ä–∞–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é:

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ [Actions ‚Üí Exif Parser Test](../../actions/workflows/build-exif-parser-test.yml)
2. –ù–∞–∂–º–∏—Ç–µ "Run workflow" ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ `main` ‚Üí –∑–∞–ø—É—Å—Ç–∏—Ç–µ
3. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 5-10 –º–∏–Ω—É—Ç
4. –°–∫–∞—á–∞–π—Ç–µ artifact `exif_parser_test_windows-x64`
5. –†–∞—Å–ø–∞–∫—É–π—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ `exif_parser_test_windows-x64.exe`

> **–ù–µ –∑–∞–±—É–¥—å—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å exiftool!** (—Å–º. –≤—ã—à–µ)

## –°–±–æ—Ä–∫–∞ –∏–∑ –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤

```bash
cd exif_parser_test
cargo build --release
cargo run --release
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º—É** (–¥–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –Ω–∞ .exe –∏–ª–∏ `cargo run --release`)
2. **–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ø–∫—É** —Å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏ –≤ –¥–∏–∞–ª–æ–≥–µ
3. **–î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è** - –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω –ø—Ä–æ–≥—Ä–µ—Å—Å
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:**

```
‚úÖ Scan complete.
Total processed: 100000
Missing GPS (we failed, exiftool succeeded): 5  ‚Üê –Ω–µ –Ω–∞—à–ª–∏ GPS
Accuracy issues (coordinates mismatch): 2       ‚Üê –Ω–∞—à–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
```

## –í—ã—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã

### üìÑ failures.txt
–§–∞–π–ª—ã –≥–¥–µ **exiftool –Ω–∞—à–µ–ª GPS**, –∞ –Ω–∞—à –ø–∞—Ä—Å–µ—Ä –Ω–µ—Ç:
```
/path/to/photo1.jpg
/path/to/photo2.heic
```
‚Üí **–ü—Ä–æ–±–ª–µ–º–∞:** –ø–∞—Ä—Å–µ—Ä –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –≤–∞–ª–∏–¥–Ω—ã–µ GPS –¥–∞–Ω–Ω—ã–µ

### üìÑ accuracy_issues.txt  
–§–∞–π–ª—ã –≥–¥–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã **–Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç** —Å exiftool:
```
/path/to/photo.jpg | Our: (48.8566, 2.3522) | exiftool: (48.8570, 2.3525) | Diff: (0.0004, 0.0003)
```
‚Üí **–ü—Ä–æ–±–ª–µ–º–∞:** –ø–∞—Ä—Å–µ—Ä —á–∏—Ç–∞–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ (tolerance: 0.0001¬∞ ‚âà 11 –º–µ—Ç—Ä–æ–≤)

### üìÅ JPG for checks/
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–ø–∏–∏ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.

## –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è

**–ü–∞—Ä—Å–µ—Ä –≤ —ç—Ç–æ–π —É—Ç–∏–ª–∏—Ç–µ = 100% –∫–æ–¥ –∏–∑ PhotoMap:**
- ‚úÖ JPEG/TIFF —á–µ—Ä–µ–∑ `kamadak-exif`
- ‚úÖ HEIC/HEIF/AVIF —á–µ—Ä–µ–∑ `libheif-rs` + `kamadak-exif`
- ‚úÖ –ü–æ–∏—Å–∫ GPS –≤ –ª—é–±–æ–º IFD (PRIMARY, GPS, –∏ –¥—Ä.)
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ "—Å–ª–æ–º–∞–Ω–Ω–æ–≥–æ" EXIF (`continue_on_error`)
- ‚úÖ Xiaomi HEIC bug (JPEG —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º .heic)

**–í–∞–ª–∏–¥–∞—Ü–∏—è:**
1. –ù–∞—à –ø–∞—Ä—Å–µ—Ä –∏–∑–≤–ª–µ–∫–∞–µ—Ç GPS
2. exiftool –∏–∑–≤–ª–µ–∫–∞–µ—Ç GPS
3. –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:
   - –û–±–∞ –Ω–µ –Ω–∞—à–ª–∏ ‚Üí OK (GPS –ø—Ä–æ—Å—Ç–æ –Ω–µ—Ç)
   - –û–±–∞ –Ω–∞—à–ª–∏ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ ‚Üí OK
   - exiftool –Ω–∞—à–µ–ª, –º—ã –Ω–µ—Ç ‚Üí **FAILURE** (coverage)
   - –ù–∞—à–ª–∏ —Ä–∞–∑–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã ‚Üí **ACCURACY ISSUE** (precision)

## Workflow —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```
1. –ù–∞—Ö–æ–¥–∏–º –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —Ñ–∞–π–ª—ã —á–µ—Ä–µ–∑ test tool
      ‚Üì
2. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–∏—á–∏–Ω—É (–∫–∞–º–µ—Ä–∞, —Ñ–æ—Ä–º–∞—Ç, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ EXIF)
      ‚Üì
3. –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –ø–∞—Ä—Å–µ—Ä –≤ exif_parser_test/src/main.rs
      ‚Üì
4. –¢–µ—Å—Ç–∏—Ä—É–µ–º ‚Üí –ø—Ä–æ–±–ª–µ–º–∞ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∞?
      ‚Üì
5. –ü–µ—Ä–µ–Ω–æ—Å–∏–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ PhotoMap/src/exif_parser/
      ‚Üì
6. –°–æ–±–∏—Ä–∞–µ–º –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é PhotoMap
```

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

- ‚úÖ **Samsung SM-G780G** - GPS –≤ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º IFD
- ‚úÖ **Xiaomi HEIC bug** - JPEG —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º .heic  
- ‚úÖ **Lightroom EXIF** - "–±–∏—Ç—ã–π" EXIF —Å –æ—à–∏–±–∫–∞–º–∏
- ‚úÖ **Apple HEIC** - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç iPhone

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- `kamadak-exif` - –ø–∞—Ä—Å–∏–Ω–≥ EXIF (—Ç–∞ –∂–µ –≤–µ—Ä—Å–∏—è —á—Ç–æ –≤ PhotoMap)
- `libheif-rs` - HEIC –ø–æ–¥–¥–µ—Ä–∂–∫–∞ (—Ç–∞ –∂–µ –≤–µ—Ä—Å–∏—è)
- `walkdir` - —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –æ–±—Ö–æ–¥ –ø–∞–ø–æ–∫
- `rfd` - –Ω–∞—Ç–∏–≤–Ω—ã–π –¥–∏–∞–ª–æ–≥ –≤—ã–±–æ—Ä–∞ –ø–∞–ø–∫–∏
- `anyhow` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- ~1-2 —Å–µ–∫—É–Ω–¥—ã –Ω–∞ 10,000 —Ñ–∞–π–ª–æ–≤ (–±–µ–∑ exiftool –ø—Ä–æ–≤–µ—Ä–∫–∏)
- ~5-10 –º–∏–Ω—É—Ç –Ω–∞ 100,000 —Ñ–∞–π–ª–æ–≤ (—Å –ø–æ–ª–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ exiftool)

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- –¢—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π exiftool
- –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å —Ñ–æ—Ä–º–∞—Ç–∞–º–∏: JPEG, HEIC, HEIF, AVIF, TIFF
- –ù–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç datetime –∏ –¥—Ä—É–≥–∏–µ EXIF –ø–æ–ª—è (—Ç–æ–ª—å–∫–æ GPS)
